<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kaleidoscopio Angular</title>
  <style>
    body, html { margin: 0; padding: 0; overflow: hidden; }
    canvas { display: block; width: 100%; height: 100%; cursor: pointer; }
  </style>
  <!-- Polyfills y Dependencias -->
  <script src="https://unpkg.com/zone.js/dist/zone.min.js"></script>
  <script src="https://unpkg.com/reflect-metadata@0.1.13/Reflect.js"></script>
  <script src="https://unpkg.com/rxjs@7.5.0/bundles/rxjs.umd.min.js"></script>
  <!-- Angular UMD Bundles -->
  <script src="https://unpkg.com/@angular/core@14.0.0/bundles/core.umd.min.js"></script>
  <script src="https://unpkg.com/@angular/common@14.0.0/bundles/common.umd.min.js"></script>
  <script src="https://unpkg.com/@angular/compiler@14.0.0/bundles/compiler.umd.min.js"></script>
  <script src="https://unpkg.com/@angular/platform-browser@14.0.0/bundles/platform-browser.umd.min.js"></script>
  <script src="https://unpkg.com/@angular/platform-browser-dynamic@14.0.0/bundles/platform-browser-dynamic.umd.min.js"></script>
</head>
<body>
  <app-root style="position:absolute;inset:0;"></app-root>

  <script>
    (function(ng, rxjs) {
      const { Component, NgModule, ViewChild, ElementRef, AfterViewInit, HostListener } = ng.core;
      const { BrowserModule } = ng.platformBrowser;
      const { platformBrowserDynamic } = ng.platformBrowserDynamic;

      @Component({
        selector: 'app-root',
        template: `<canvas #canvas (click)="clearCanvas()"></canvas>`,
      })
      class AppComponent extends AfterViewInit {
        @ViewChild('canvas', { static: true }) canvasRef;
        animationId;
        ctx;
        w = 0;
        h = 0;

        ngAfterViewInit() {
          const canvas = this.canvasRef.nativeElement;
          this.ctx = canvas.getContext('2d');
          this.onResize();
          this.animate(0);
          window.addEventListener('resize', () => this.onResize());
        }

        @HostListener('window:resize') onResize() {
          const canvas = this.canvasRef.nativeElement;
          this.w = canvas.width = window.innerWidth;
          this.h = canvas.height = window.innerHeight;
        }

        animate(t) {
          if (!this.ctx) return;
          // Fondo din√°mico
          this.ctx.fillStyle = `hsl(${(t * 0.005) % 360}, 50%, 15%)`;
          this.ctx.fillRect(0, 0, this.w, this.h);

          const segments = 16;
          const angle = (2 * Math.PI) / segments;
          const radius = Math.min(this.w, this.h) / 2;

          for (let i = 0; i < segments; i++) {
            this.ctx.save();
            this.ctx.translate(this.w / 2, this.h / 2);
            this.ctx.rotate(i * angle + t * 0.0003);

            this.ctx.beginPath();
            for (let j = 0; j < 6; j++) {
              const theta = (j / 6) * 2 * Math.PI;
              const r = radius * (0.3 + 0.7 * Math.sin(t * 0.001 + i + j));
              const x = Math.cos(theta) * r;
              const y = Math.sin(theta) * r;
              j === 0 ? this.ctx.moveTo(x, y) : this.ctx.lineTo(x, y);
            }
            this.ctx.closePath();
            this.ctx.fillStyle = `hsl(${(t * 0.02 + i * (360/segments)) % 360}, 80%, 60%)`;
            this.ctx.fill();
            this.ctx.restore();
          }

          this.animationId = requestAnimationFrame(ts => this.animate(ts));
        }

        clearCanvas() {
          if (this.ctx) this.ctx.clearRect(0, 0, this.w, this.h);
        }
      }

      @NgModule({
        imports: [BrowserModule],
        declarations: [AppComponent],
        bootstrap: [AppComponent]
      })
      class AppModule {}

      platformBrowserDynamic().bootstrapModule(AppModule)
        .catch(err => console.error(err));
    })(window.ng, window.rxjs);
  </script>
</body>
</html>
